\section{Ontwerp}\label{sec:ontwerp}
Het systeem bestaat uit 2 hoofdonderdelen: de sensormodule en een basisstation. De sensormodule meet de pH waarde van een oplossing, en verzend deze naar het basisstation. Het basisstation ontvangt de informatie en slaat deze informatie op.
In \cref{fig:functional} is dit te zien in een systeemdiagram.

\begin{figure}[!htbp]
    \centering
    \includegraphics{toplevelDiagram}
    \caption[short]{Een diagram van het volledige systeem.}
    \label{fig:functional}
\end{figure}

Het sensormodule blok kan wederom opgedeeld worden in aparte blokken. Dit is te zien in \cref{fig:moduleDiagram}.

\begin{figure}[!htbp]
    \centering
    \includegraphics[width=0.75\textwidth]{moduleDiagram}
    \caption{Een systeemdiagram van de sensormodule.}
    \label{fig:moduleDiagram}
\end{figure}

\subsection{Functionele decompositie} \label{sec:functioneleDecompositie}
De sensormodule kan opgedeeld worden in 2 aparte systemen: de voeding, die verder wordt besproken in \cref{sec:voeding}, en de signaalverwerking.

De signaalverwerking bestaat zelf ook weer uit 2 onderdelen: het analoge gedeelte en het digitale gedeelte. In \cref{fig:analogeBewerkingsFunctie} is een decompositie te zien van de signaalbewerkingsfuncties die toegepast worden in het analoge gedeelte. In de komende paragrafen wordt elk van deze blokken apart besproken.

\begin{figure}[!htbp]
    \centering
    \includegraphics[width=0.95\textwidth]{analogeBewerkingsFunctie}
    \caption{Het analoge gedeelte van de signaalbewerking.}
    \label{fig:analogeBewerkingsFunctie}
\end{figure}


Het digitale gedeelte bestaat uit een aantal berekeningen. Deze berekeningen zijn nodig om de gemeten spanning om te rekenen naar een pH waarde. Hiervoor zijn een aantal kalibratiewaardes nodig, zoals besproken in \cref{sec:werkingISFET}. Het digitale gedeelte heeft als ingang een temperatuursafhankelijke spanning $U_T$ en een pH-afhankelijke spanning $U_{pH}$. Dit is te zien in \cref{fig:digitaleBewerkingsFunctie}. Beide van deze spanningen zijn de ruwe ADC waardes die gemeten worden, en hebben dus de hoogst mogelijke resolutie, namelijk de resolutie van de ADC. Voor beide van deze waardes zal de eenheid `bit' gebruikt worden.

Om op de uiteindelijk pH waarde te komen, wordt van de pH-afhankelijke spanning de pH-afhankelijke kalibratiespanning afgetrokken. Vervolgens wordt hier $\frac{pH_{kal}}{C_{pH}}$ bij opgeteld. Op deze manier kan er zo lang mogelijk met integers gewerkt worden die dezelfde resolutie hebben als de ingangs-ADC waarde. Het resultaat wordt vervolgens vermenigvuldigd met $C_{pH}$. Dit is de gevoeligheid van de sensor, in pH/bit.

Om de temperatuursafwijking te berekenen, wordt eerst van de temperatuursafhankelijke spanning $U_T$ de temperatuursafhankelijke kalibratiespanning $U_{T,kal}$ afgetrokken. Vervolgens wordt dit vermenigvuldigt met constante $C_T$. $C_T$ is de temperatuursafhankelijkheid van de pH-sensor, in pH/bit. Deze waarde kan afgeleid worden met de temperatuursafhankelijkheid van de pH-sensor die in de datasheet gegeven wordt in mV/K \cite{isfet}.

\begin{figure}[!htbp]
    \centering
    \includegraphics[width=0.95\textwidth]{digitaleBewerkingsFunctie}
    \caption{Het digitale gedeelte van de signaalbewerking.}
    \label{fig:digitaleBewerkingsFunctie}
\end{figure}


\subsection{Ruisverdeling}
In hoofdstuk \ref{sec:systemSpecifications} is er een ruisspecificatie voor de uitgang van dit systeem gegeven. Daarna is in \cref{sec:functioneleDecompositie} gekeken naar welke basissignaalbewerkingsfuncties er moeten worden geïmplementeerd. Een overzicht van de te implementeren basissignaalbewerkingsfuncties is te zien in \cref{fig:analogeBewerkingsFunctie,fig:digitaleBewerkingsFunctie}. Bij de verdeling van het ruisbudget is ook onderscheid gemaakt tussen de analogesignaalbewerkingsfuncties en de digitalesignaalbewerkingsfuncties.

Alle digitalesignaalbewerkingsfuncties mogen gezamelijk maximaal 1dB aan ruis produceren. De optelling van de uitangen van $C_{pH}$ en $C_T$ in \cref{fig:digitaleBewerkingsFunctie} is de enige digitalesignaalbewerkingsfunctie waarbij de ruisvloer van het pH signaal wordt vergroot.

Wanneer de digitalesignaalbewerkingsfuncties gezamelijk een ruisgetal van \qty{1}{\decibel} hebben moet de \SNR van het signaal na de ADC minimaal \qty{34}{\decibel} zijn. In de specificaties van het systeem is namelijk aangegeven dat de \SNR aan de uitgang van het systeem minimaal \qty{\SNRout}{\decibel} moet zijn. Voor de overgebleven analogesignaalbewerkingsfuncties uit \cref{fig:analogeBewerkingsFunctie}, is er een ruisgetal van \qty{3}{\decibel} gekozen. Dit houdt in dat elk van deze analogesignaalbewerkingsfuncties zelf evenveel ingangsgerelateerde ruis mogen produceren als de ruis die ze op de ingang van het analogesignaalbewerkingsfunctie blok ontvangen.
% Om op een hoogniveau aannemelijk te kunnen maken dat de systeemruiseis gehaald kan worden als elke signaalbewerkingsfunctie zo is geïmplementeerd dat deze aan zijn specificatie voldoet

\input{sections/meten}
\input{sections/divider}
\input{sections/adc}
\input{sections/filter}
\input{sections/rf}
\input{sections/voedingOntwerp}
\input{sections/energieBudget}






% \begin{table}[!htbp]
%     \centering
%     \begin{tabular}{|l|r|}
%         \hline
%         Ingangen    & Oplossing met een pH waarde tussen de 2 en 10 \\
%                     & Een temperatuur tussen de fliep en floep $^\circ$C \\
%         \hline
%         Uitgangen   & Een BLE RF signaal \\
%         \hline
%         Functie     & Meet de pH waarde van een oplossing en stuurt deze op naar een basisstation.  \\
%         \hline
%     \end{tabular}
%     \caption{Specificaties van }
%     \label{tab:in en uitgangen}
% \end{table}


% TODO: Moet gereformateerd zodat het past in dit formaat.
%\input{sections/functioneel.tex}
